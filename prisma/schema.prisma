generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model GlobalFilament {
  id            String  @id @default(uuid())
  brand         String
  material      String
  material_type String?
  color_name    String
  upc_gtin      String? @unique
  color_hex     String?
  nozzle_temp   String?
  bed_temp      String?
  print_speed   String?
  logo_url      String?

  // Technical Details
  density            String?
  diameter           String?
  nominal_weight     String?
  softening_temp     String?
  chamber_temp       String?
  ironing_flow       String?
  ironing_speed      String?
  shrinkage          String?
  empty_spool_weight String?
  pressure_advance   String?

  // Fan Speed
  fan_min String?
  fan_max String?

  // First Layer Speeds
  first_layer_walls       String?
  first_layer_infill      String?
  first_layer_outer_wall  String?
  first_layer_top_surface String?

  // Other Layers
  other_layers_walls       String?
  other_layers_infill      String?
  other_layers_outer_wall  String?
  other_layers_top_surface String?

  // Tested Color Data
  measured_rgb String?
  top_voted_td String?
  num_td_votes String?

  // Flow Characteristics
  max_volumetric_speed String?
  flow_ratio           String?

  // Drying Info
  drying_temp String?
  dry_time    String?

  // AMS Compatibility & Build Plates
  ams_compatibility String?
  build_plates      String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  spools Spool[]

  @@unique([brand, material, color_name])
}

model Location {
  id         String  @id @default(uuid())
  name       String
  type       String  @default("custom")
  is_default Boolean @default(false)

  // AMS Slot 专用字段
  printer_name String?
  ams_unit     String?
  ams_slot     String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  spools Spool[]
}

enum SpoolStatus {
  ACTIVE
  EMPTY
}

model Spool {
  id                 String      @id @default(uuid())
  global_filament_id String
  location_id        String?
  status             SpoolStatus @default(ACTIVE)
  metadata           String?
  created_at         DateTime    @default(now())
  updated_at         DateTime    @updatedAt

  globalFilament GlobalFilament @relation(fields: [global_filament_id], references: [id], onDelete: Restrict)
  location       Location?      @relation(fields: [location_id], references: [id])

  @@index([global_filament_id])
  @@index([location_id])
  @@index([status])
}
